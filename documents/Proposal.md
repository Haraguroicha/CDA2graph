**以雲端運算平台建置電子病歷檢視器系統之整合設計與實作**===============================================### *Design and implementation of using a cloud computing platform to build the electronic medical record viewer integration system*
----
# 論文摘要

	暫時沒內容

**關鍵字：_電子病歷、XML、CDA、雲端、檢視器_**

----
# 第一章 緒論

## 第一節 研究背景

鑒於國內電子病歷已施行多年，但這些資料仍存放在各家醫療單位所屬的資訊系統，無法全面互相交換，導致醫療資源無法有效的整合與利用，民眾更是無法使用散落在各醫療院所的病歷資料在每次的就醫過程中。在民國九十八年依據醫療院所在實際使用的經驗上優先選取了常用的108份表單，並且制定了電子病歷表單的欄位與資料格式標準，直至目前為止，在民國九十九年衛生署實施的『醫院實施電子病歷及互通補助計畫』中，公告了「醫療影像報告」、「出院病歷摘要」、「血液檢驗報告」與「門診用藥」等四張病歷單張交換的欄位與格式之標準，做為目前醫院與醫院或診所間電子病歷交換互通的單張規範。同時，為了快速達到預期之目的，『99年度加速診所實施電子病歷推廣案』中，制定了「西醫門診」、「中醫門診」和「牙醫門診」等三張門診病歷單張給診所交換使用。

而目前一〇一年衛生署即將推行打造「全民健康雲」，該計劃中率先使用了微軟的Windows Azure平台，整合健康、醫療、保險等相關機構所持有的個人健康履歷，包括施打疫苗、健康檢查、就醫診療、門診用藥記錄、醫療保險等資訊。現階段產生符合標準CDA文件對於醫療單位已經是必備的條件了，為了符合接下來的這些政策及趨勢，資料交換已經不是主要的重點，而是這些資料交換後要如何有效地被利用與如何有效的讓這些資料的擁有者更有效的使用，這些重點就是在於如何呈現這些資料的結果，電子病歷的呈現方式在目前仍有極大的發展空間！

## 第二節 研究動機

鑒於目前政府積極發展電子病歷，各醫療院所也皆致力於開發各種電子病歷交換的中介程式，但資料在交換之後若要到其他醫療院所使用則必須在該院所有建置該病歷單張的匯入中介程式，倘若沒有建置這部分的程式，則失去了資料交換的意義，也因此就無法瀏覽該資料的內容，若有一平台能夠統一的讓醫護人員可以直接瀏覽這些無法匯入至系統的交換資料則能夠大幅的增加資料交換的可用性！同時也能夠提供未來若民眾可以自行攜帶電子病歷出院，民眾也可以透過此一平台瀏覽自己的病歷資料，而此一平台只需要醫療院所有提供專用的顯示樣板檔即可讓民眾隨時檢視資料。

本研究將以行政院衛生署公告的電子病歷交換標準文件為例，並且將目前實際運作的四個正式單張與診間使用的三張門診單張來製作通用的樣板檔，並且提供給各醫療院所有個製作樣板的編輯器，藉此方便開發未來還尚未正式使用108張。

## 第三節 研究目的

本研究目的在於建立一套得以使各家醫療院所產出的電子病歷互通檢視的雲端平台，透過各家醫療院所客製化的表單至其他單位檢視使用，也可協助病患自行使用此平台，迅速檢視自己的病歷資料。本系統提供給醫療院所及病患使用兩種途徑，並在系統中區分出檢視器及編輯器兩大部分。本研究具體目的為下列所述：

1. 建置一套電子病歷檢視器的雲端平台可供任何使用者與單位在任何地方使用，作為國內醫療雲的附屬應用系統。
2. 參考HL7 CDA文件架構及行政院衛生署公告之電子病歷交換標準規範書來實作本研究之檢視器及編輯器，並可以將單張範本存回病歷檔增加可攜性。
3. 提供全國醫療院所可以將建立的電子病歷表單單張範本上傳，並且可供不同醫療院所檢視病歷時可快速套用自行設計的樣板。
4. 令使用本系統的使用者可節省電子病歷導入轉換的時間與成本及人力。
5. 可以使引進本系統功能的醫療資訊系統可以利用本系統的API產生電子報表

----
# 第二章 文獻探討

本章節依照研究目的，首先探討電子病歷，再進一步的探討目的中所使用醫療資訊標準中的HL7 CDA架構及國內電子病歷規範，最後探討XML在電子病歷中的重要性，以及雲端運算在本研究中的重要度。

## 第一節 電子病歷

	暫時沒內容

## 第二節 國內電子病歷規範

	暫時沒內容

## 第三節 醫療資訊標準

	暫時沒內容

### 壹 臨床文件架構

	暫時沒內容

## 第四節 XML

	暫時沒內容

## 第五節 雲端運算

	暫時沒內容

----
# 第三章 研究方法

本章節依序說明研究步驟、系統需求分析與設計、相關技術應用及開發環境與工具。

## 第一節 研究步驟

本研究會設計一個電子病歷的檢視平台，並且提供各醫療院所及民眾使用，主要提供醫療院所做為一個資料交換後的中介檢視平台，以便那些還尚未部屬完成電子病歷匯入程式的單位使用，並且可以在線上開發其他單張所需的檢視模板，也可提供給民眾使用。最後將探討電子病歷之架構及相關電子病歷之雲端應用研究，並且以實作的方式建立此系統平台完成本研究之計畫。其詳細的研究流程從研究背景、動機及目的、文獻探討、研究方法與預期成果如圖1所示。

### 壹 研究流程

![研究流程圖](./graffle/systemProcess.png)

圖1 研究流程圖

### 貳 系統建置流程


1. 研究CDA文件架構
	
	研究CDA文件內的架構與模型、參考方式、資料屬性及詞彙等，研究文件的階層及儲存位置還有形態等內容。
	
2. 分析電子病歷文件單張
	
	為了區分出每個單張的不同，以及辨識不同單張所需的樣板檔，必須先瞭解電子病歷文件中所記錄的代碼為何種意義，以便瞭解哪個代碼的特性為何，並且針對該代碼來作為區分用途。
	
3. 研究XPath使用特性
	
	在電子病歷文件中接使用XML來儲存內容，若要萃取出資料則必須要有選擇，而在XML文件中要萃取出需要的資料則是要先瞭解XPath內的特性以及使用方式。
	
4. 訂定系統需求與系統設計
	
	針對本研究之系統訂定系統需求與系統設計，依照使用對象的不同區分為兩大部份，並在完成這兩大部份後完成本系統平台之設計。
	
	1. 醫事單位
		
		由於醫事單位有開發上的需求以及會有內部人員的需要，故在此部分會要有一個特別設計的編輯模式可供這些醫事單位可以用所見即得的方式在線上編輯樣板檔，並且可以隨時發佈變更給所有的使用者使用。
		
	2. 醫事人員與一般民眾
		
		依照使用者的喜好與習慣為原則，因此這部分會用一個類似於文件檢視器的形式來呈現最後解析處理後的電子病歷結果。
		
5. 系統開發
	
	本研究主要分為四個開發部分，並且在一連串的建置與測試後，經由電子病歷文件的引入來確認是否能夠符合不失去原始內容的呈現。
	
	1. 建置系統界面框架
	
		建置系統界面的框架，提供使用者直覺的檢視資料。其中必須提供檢視工具，包含上一頁、下一頁、直接換頁，若在個人資料法的允許下則會提供列印的功能。在檢視器的畫面中呈現出如同真實紙本資料的畫面，並且可以直接顯示圖表，或者可程式化的互動介面，使電子病歷不再只是作為資料交換的用途。而在畫面上會提供使用者可以使用拖拉的方式將檔案置入檔案解析介面中開始解析檔案。
	
	2. 檔案解析介面
	
		讓使用者可以將檔案匯入至頁面中解析資料，並且可以結合模板互相搭配呈現畫面。其中會依據電子病歷檔案內的屬性來判斷該檔案是為哪一單張的資料結構，隨之自動的配合相對應的單張樣板檔來呈現該單張的顯示介面以及互動介面。
	
	3. 模板編輯界面框架
	
		模板編輯器的界面可以提供醫療院所設計每個不同的單張所專用的顯示結果，甚至可以設計模組套件，在設計完成後即可發佈給其他設計者引用協做。
	
	4. 模板管理界面
	
		管理已經設計好的模板，並且可以編輯或者引用其他設計者所設計好的介面，另外提供版本歷程的記錄，以避免版本變更後的不預期問題發生。
	
6. 研究成果撰寫
	
	撰寫系統建置與實作結果的文件，並討論發表過程中的問題與困難點，以提供後續研究或者導入本系統之單位的後續發展與參考。

## 第二節 系統需求分析與設計

本部份分為兩個部份，第一個部份會根據需求來分析與系統架構，在第二部份會根據第一部份的結果來做系統分析與系統架構的設計。

### 壹 需求分析與系統架構

為了使電子病歷最終可以顯示成為圖表化的病歷資料，如同實際在紙本作業程序中的感受一致，故依照系統使用的相關人員而區分為三大類，以下分別說明：

* 醫事單位：負責文件樣板的設計以及開發，讓醫事人員以及一般民眾可以很容易的使用本系統瀏覽由醫院所輸出的電子病歷資料，以及和其他系統的整合應用。
* 醫事人員：可以使用本系統作為一個電子病歷的檢視，讓醫事人員可以不用等待資訊系統的匯入等待時間即可立即瀏覽內容，也可以經由本系統導入資料至醫事單位所開發整合的系統中作為存儲。
* 一般民眾：僅只有電子病歷的檢視功能，最終顯示的方式使用HTML5的方式呈現。

依照上述需求，可分析出系統與其相關使用者的關係如圖2所示。

![系統架構圖](./graffle/systemArchitecture.png)

圖2 系統架構圖

### 貳 系統分析與設計

由圖2的系統架構圖中可以得知系統中有四個部分組成運作，分別為樣板檔資料庫、樣板檔組合電子病歷形成檢視、醫事單位開發界面及外部使用的API界面，其中以開發界面最為重要，因為包含了形成檢視的檢視畫面以外，還必須有設計的功能，並且還要結合樣板檔資料庫，以便開發中引用其他樣板做進一步開發。以下將對這幾部分加以探討：

1. 樣板檔資料庫
	
	
	
2. 樣板檔組合電子病歷形成檢視
	
	
	
3. 醫事單位開發界面
	
	
	
4. 外部使用的API界面
	
	
	
## 第三節 相關技術及開發工具

本研究準備使用的開發環境、開發工具、開發程式語言如下：

- 開發環境：Macintosh OS X Mountain Lion 10.8.2、Microsoft Window 7
- 開發工具：Sublime Text 2、SourceTree、Google Chrome、Mou
- 開發語言：HTML 5、JavaScript、jQuery、jQuery UI、CSS、SASS、php、mySQL、Markdown

----
# 第四章 預期成果

以目前國內電子病歷推行發展的狀況約有上百單張，若除去目前正式使用的4張單張以外，希望還有更多草案階段的單張能夠順利推行。各家醫療院所若皆能使用本系統開發表單及介接程式，本研究同時也會收集各家使用單位所設計出的病歷單張表單樣板檔，希望能藉此令電子病歷的表單樣板制定能夠減少民眾在瀏覽閱讀時的疑惑及不便。

本研究預期將完成設計出一套電子病歷檢視器的雲端應用平台，供使用者在任何有網路的環境皆能使用此一平台瀏覽手邊的電子病歷資料，並且可以讓醫療院所自行插入該單位設計的樣板檔，讓使用者可以直接瀏覽使用也不影響檔案在各單位之間的資料交換，除資料交換以外也可以讓醫療資訊系統呼叫引用本系統的功能，以達到SaaS的服務，期望在此系統平台完成後，能夠有多家單位使用，並能夠對臺灣的電子病歷交換能夠有所幫助！

----
# 第五章 可能遭遇的困難

* 雲端平台建置：礙於經費上的問題導致無法實際建置雲端平台之平台與購置設備，故目前必須使用協力廠商或其他解決方案，因此現行架構上使用虛擬化架構來作為未來環境建制的測試環境。
* 電子病歷交換標準單張：由於目前上線使用的交換單張有「醫療影像報告」、「出院病歷摘要」、「血液檢驗報告」與「門診用藥」等四張病歷單張，以及「西醫門診」、「中醫門診」和「牙醫門診」等三張門診病歷單張，其餘尚未正式使用的108張單張所使用的資料因為還沒正式使用，所以目前無法收集到其正確分辨單張用的資料欄位，因此系統上需要額外有一個單張對應的模組區塊，並且可以隨著政策的變化一起同步的更新。

----
# 參考文獻

	暫時沒內容

----
# 檔案結尾
	此行以下已經沒有任何內容